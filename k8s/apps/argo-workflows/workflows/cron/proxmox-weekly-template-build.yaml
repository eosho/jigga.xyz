# Weekly Proxmox Template Build
# Runs every Sunday at 3:00 AM to rebuild Ubuntu templates
apiVersion: argoproj.io/v1alpha1
kind: CronWorkflow
metadata:
  name: proxmox-weekly-template-build
  namespace: argo-workflows
  labels:
    app.kubernetes.io/name: argo-workflows
    app.kubernetes.io/component: cron-workflow
spec:
  # Every Sunday at 3:00 AM
  schedule: "0 3 * * 0"
  timezone: "America/New_York"
  concurrencyPolicy: "Forbid"
  startingDeadlineSeconds: 3600
  successfulJobsHistoryLimit: 4
  failedJobsHistoryLimit: 2

  workflowSpec:
    workflowTemplateRef:
      name: proxmox-template-builder
    arguments:
      parameters:
        - name: ubuntu-version
          value: "24.04"
        - name: storage
          value: "local-lvm"
        - name: force-rebuild
          value: "false"  # Use hash comparison - only rebuild if new image available
        - name: nodes
          value: '["pve-alpha", "pve-beta", "pve-gamma"]'
