apiVersion: v1
kind: ConfigMap
metadata:
  name: gatus-config
  namespace: gatus
data:
  config.yaml: |
    ui:
      title: "Jigga.xyz Status"
      header: "Service Status"
      description: "Real-time status of all services"

    storage:
      type: postgres
      path: ${DATABASE_URL}

    alerting:
      discord:
        webhook-url: "${DISCORD_WEBHOOK_URL}"
        default-alert:
          enabled: true
          description: "Health check failed"
          send-on-resolved: true
          failure-threshold: 3
          success-threshold: 2

    endpoints:
      # Web Applications (using internal K8s service URLs)
      - name: Homepage
        group: Web Apps
        url: "http://homepage.web:80"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: ArgoCD
        group: Web Apps
        url: "http://argocd-server.argocd:80"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      - name: Argo Workflows
        group: Web Apps
        url: "http://argo-workflows-server.argo-workflows:2746"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      - name: Grafana
        group: Web Apps
        url: "http://kube-prometheus-stack-grafana.monitoring:80/api/health"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: Prometheus
        group: Web Apps
        url: "http://kube-prometheus-stack-prometheus.monitoring:9090"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: Alertmanager
        group: Web Apps
        url: "http://kube-prometheus-stack-alertmanager.monitoring:9093"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: Vaultwarden
        group: Web Apps
        url: "http://vaultwarden.vaultwarden:80"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: Dozzle
        group: Web Apps
        url: "http://logs-ui.dozzle:80/health"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"
        alerts:
          - type: discord

      - name: Dozzle (Ingress)
        group: Web Apps
        url: "https://logs.int.jigga.xyz/health"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      # MQTT
      - name: Mosquitto
        group: MQTT
        url: "tcp://mosquitto.mqtt:1883"
        interval: 30s
        conditions:
          - "[CONNECTED] == true"
        alerts:
          - type: discord

      - name: Mosquitto (LAN)
        group: MQTT
        url: "tcp://192.168.7.231:1883"
        interval: 30s
        conditions:
          - "[CONNECTED] == true"
        alerts:
          - type: discord

      # Infrastructure
      - name: Traefik
        group: Infrastructure
        url: "https://192.168.7.230"
        client:
          insecure: true
        interval: 30s
        conditions:
          - "[STATUS] == 404"  # Traefik returns 404 on root without route
        alerts:
          - type: discord

      - name: code-server
        group: Infrastructure
        url: "http://192.168.7.240:8080"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      - name: PDM
        group: Infrastructure
        url: "https://192.168.7.241:8443"
        client:
          insecure: true
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      # Proxmox Nodes
      - name: pve-alpha
        group: Proxmox
        url: "https://192.168.7.233:8006"
        client:
          insecure: true
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      - name: pve-beta
        group: Proxmox
        url: "https://192.168.7.234:8006"
        client:
          insecure: true
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      - name: pve-gamma
        group: Proxmox
        url: "https://192.168.7.235:8006"
        client:
          insecure: true
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      # Network
      - name: UniFi
        group: Network
        url: "https://192.168.1.1"
        client:
          insecure: true
        interval: 60s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"
        alerts:
          - type: discord

      # Kubernetes API
      - name: Kubernetes API
        group: Kubernetes
        url: "https://kubernetes.default.svc"
        client:
          insecure: true
        interval: 30s
        conditions:
          - "[STATUS] == any(401, 403)"  # Unauthorized without token is expected
        alerts:
          - type: discord
